{
  "permissions": {
    "allow": [
      "Bash(npm install)",
      "Bash(lsof:*)",
      "Bash(xargs kill:*)",
      "Bash(npm test:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfeat: initial implementation of Bitfocus Telemetry Bridge\n\nA production-grade, state-first integration hub providing bidirectional\ncommunication between Bitfocus Companion, Bitfocus Buttons, and custom\nclient applications.\n\nArchitecture\n------------\n- State-first design with canonical state store \\(not pure event-driven\\)\n- Ownership model: each state path has a single authoritative owner\n- Staleness tracking for graceful handling of adapter disconnections\n- Wildcard pattern matching for subscriptions \\(* single, ** multi-level\\)\n- UUID v7 for time-ordered, debuggable message IDs\n\nBridge Protocol v0.1\n--------------------\n- Vendor-agnostic message envelope with Zod runtime validation\n- Message types: command, event, state, ack, error, subscribe, unsubscribe\n- Sequence counters per source for ordering guarantees\n- Idempotency support via optional idempotencyKey field\n- Correlation IDs for request/response tracking\n\nCompanion Adapter \\(Production-Ready\\)\n------------------------------------\n- Full Satellite API implementation over WebSocket \\(port 16622\\)\n- Device registration with configurable grid layout\n- Variable subscription and state publication\n- Key state tracking with press/release/hold detection\n- Bi-directional command support \\(key presses, variable writes\\)\n- Auto-reconnect with configurable backoff\n- Capability detection \\(variables, rotation, key images\\)\n- Comprehensive simulator for testing without real Companion\n\nButtons Adapter \\(Placeholder per ADR-003\\)\n-----------------------------------------\n- Complete interface contract defined \\(ButtonsAdapter\\)\n- Type definitions for devices, keys, encoders, events\n- Transport abstraction layer \\(WebSocket, OSC, MQTT ready\\)\n- Protocol codec abstraction for wire format\n- Placeholder implementation using in-memory transport\n- Full simulator for testing device scenarios\n- Contract test suite ensuring future implementations comply\n\nClient Transport\n----------------\n- WebSocket server for external application connections\n- Session management with configurable limits\n- Rate limiting with sliding window\n- Optional authentication via tokens\n- Compression support\n- Heartbeat/keepalive mechanism\n\nObservability\n-------------\n- Structured JSON logging via pino with pretty-print dev mode\n- Prometheus metrics endpoint \\(/metrics on port 9090\\)\n- Health check endpoint \\(port 9091\\)\n- Per-adapter metrics \\(messages, latency, connections\\)\n\nConfiguration\n-------------\n- Zod schema validation with sensible defaults\n- File-based config \\(bridge.config.json\\)\n- Environment variable overrides \\(BRIDGE_*\\)\n- Runtime validation with helpful error messages\n\nTesting\n-------\n- Unit tests for state store and subscription manager\n- Contract tests for buttons adapter interface\n- Integration tests for companion adapter with simulator\n- 88 tests, all passing\n\nProject Structure\n-----------------\nsrc/\n├── core/           # Protocol, state store, router\n├── adapters/       # Companion \\(full\\), Buttons \\(placeholder\\)\n├── transports/     # Client WebSocket server\n├── observability/  # Logging, metrics, health\n├── config/         # Schema and loader\n├── bridge.ts       # Main orchestrator\n└── cli.ts          # Entry point\n\ndocs/\n├── adr/            # Architecture decision records\n├── specs/          # Protocol specification\n└── guides/         # Usage documentation\n\ntests/\n├── unit/           # State store, subscriptions\n├── contract/       # Buttons adapter contract\n└── integration/    # Companion adapter with simulator\nEOF\n\\)\")"
    ]
  }
}
